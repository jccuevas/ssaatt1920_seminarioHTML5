<!DOCTYPE html>
<html lang="es" dir="ltr">
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="estilos/normalize.css">
        <link rel="stylesheet" href="estilos/main.css">
        <title>APIs de JavaScript - AJAX - CORS</title>

        <style>
            .resultado{
                background-color: darkgray;
                color:white;
                font-family: monospace;
                width: 50%;
                overflow: auto;
                padding: 5px;
                border: 5px solid black;

            }
            label{
                display: inline-block;
                min-width: 100px;

            }



        </style>
    </head>
    <body>
        <header>
            <h1>APIs de JavaScript - Ejemplos de protección entre orígenes y CORS</h1>
        </header>
        <main>
            <p>En esta página se muestran ejemplos de la protección del navegador para acceso del uso cruzado entre orígenes y su habilitación mediante CORS</p>
            <section>
                <h2>Peticiones de origen cruzado y a través de CORS</h2>
                <article>
                    <h3>Ejemplo de acceso cruzado no cortada</h3>
                    <aside>
                        <h4>&lt;script&gt;</h4>
                        <pre>

}       
                        </pre>
                    </aside>
                    <p>El recurso <code>http://labtelema.ujaen.es/api/form.php</code> hace un eco de los parámetros enviados.</p>
                    <p>En este primer ejemplo no hay ningún formulario pero se envían datos don el mismo formato con FormData</p>
                    <button onclick="getData('http://labtelema.ujaen.es/api/form.php', this)">Enviar</button>
                    <div id="resultado1" class="resultado">

                    </div>
                    <script>
                        var req = new XMLHttpRequest();
                        const resultado = document.getElementById("resultado1");

                        /**
                         * Envía las propiedades del objeto target por POST a url
                         * @param {type} url de detino
                         * @param {type} target es el objeto a procesar
                         * @returns {undefined}
                         */
                        function getData(url) {

                            let datos = new FormData;
                            const event = new Date(Date.now());
                            const options = {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'};

                            datos.append("user", "usuario");
                            datos.append("pass", "12345");
                            datos.append("date", event.toLocaleDateString("es-Es", options));

                            req.onreadystatechange = function (evento) {

                                if (req.readyState === this.DONE) {//Estado 4
                                    if (req.status === 200) {
                                        let tipo = req.getResponseHeader("Content-Type");

                                        console.log("Contenido tipo MIME:" + tipo);
                                        console.log("Contenido tipo:" + req.responseType);
                                        resultado.innerHTML = req.responseText;
                                    } else {
                                        console.log("[" + req.readyState + "] Error recibiendo datos\n");
                                    }
                                }
                            };
                            req.open('POST', url);
                            req.send(datos);
                        }
                    </script>                
                </article>
                
            </section>

            <section><br><a href="index.html">Inicio</a><br></section>
        </main>
        <footer><p>Servicios y Aplicaciones Telemáticas</p></footer>
    </body>
</html>

